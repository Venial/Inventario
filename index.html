<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventario RES</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
        color: #333;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #2c3e50;
        margin-bottom: 5px;
      }
      .date {
        color: #7f8c8d;
        margin-bottom: 20px;
      }
      .search-container {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      input,
      select,
      button {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      button {
        background-color: #3498db;
        color: white;
        border: none;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      button:hover {
        background-color: #2980b9;
      }
      .btn-danger {
        background-color: #e74c3c;
      }
      .btn-danger:hover {
        background-color: #c0392b;
      }
      .btn-success {
        background-color: #2ecc71;
      }
      .btn-success:hover {
        background-color: #27ae60;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      th {
        background-color: #f2f2f2;
        font-weight: 600;
      }
      tr:hover {
        background-color: #f9f9f9;
      }
      .action-btns {
        display: flex;
        gap: 5px;
      }
      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
      }
      .modal-content {
        background-color: white;
        margin: 10% auto;
        padding: 20px;
        border-radius: 8px;
        width: 80%;
        max-width: 500px;
      }
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }
      .close:hover {
        color: black;
      }
      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
      }
      .print-btn {
        margin-bottom: 20px;
        background-color: #9b59b6;
      }
      .print-btn:hover {
        background-color: #8e44ad;
      }
      @media print {
        .no-print {
          display: none;
        }
        body {
          background-color: white;
          padding: 0;
        }
        .container {
          box-shadow: none;
          padding: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Inventario RES</h1>
      <div class="date" id="current-date"></div>

      <button class="print-btn no-print" onclick="window.print()">
        üñ®Ô∏è Imprimir
      </button>

      <div class="search-container no-print">
        <input
          type="text"
          id="search-input"
          placeholder="Buscar producto o rubro..."
          style="flex-grow: 1"
        />
        <button id="add-product-btn">‚ûï Agregar Producto</button>
      </div>

      <table id="inventory-table">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Rubro</th>
            <th>Cantidad</th>
            <th>Unidad</th>
            <th class="no-print">Acciones</th>
          </tr>
        </thead>
        <tbody id="table-body">
          <!-- Los productos se cargar√°n aqu√≠ din√°micamente -->
        </tbody>
      </table>
    </div>

    <!-- Modal para agregar/editar productos -->
    <div id="product-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modal-title">Agregar Producto</h2>
        <form id="product-form">
          <input type="hidden" id="product-id" />
          <div class="form-group">
            <label for="product-name">Producto:</label>
            <input type="text" id="product-name" required />
          </div>
          <div class="form-group">
            <label for="product-category">Rubro:</label>
            <input type="text" id="product-category" required />
          </div>
          <div class="form-group">
            <label for="product-quantity">Cantidad:</label>
            <input type="number" id="product-quantity" step="0.01" required />
          </div>
          <div class="form-group">
            <label for="product-unit">Unidad:</label>
            <select id="product-unit" required>
              <option value="unidades">Unidades</option>
              <option value="kg">Kilogramos (kg)</option>
              <option value="mg">Miligramos (mg)</option>
            </select>
          </div>
          <button type="submit" class="btn-success">Guardar</button>
        </form>
      </div>
    </div>

    <script>
      // Mostrar fecha actual
      function updateDate() {
        const now = new Date();
        const options = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
          timeZone: "America/Argentina/Buenos_Aires",
        };
        document.getElementById("current-date").textContent =
          now.toLocaleDateString("es-AR", options);
      }
      updateDate();
      setInterval(updateDate, 60000); // Actualizar cada minuto

      // Datos de ejemplo (en una app real, esto vendr√≠a de una base de datos)
      let inventory = [
        {
          id: 1,
          name: "Harina 000",
          category: "Almac√©n",
          quantity: 5,
          unit: "kg",
        },
        { id: 2, name: "Az√∫car", category: "Almac√©n", quantity: 3, unit: "kg" },
        {
          id: 3,
          name: "Leche entera",
          category: "L√°cteos",
          quantity: 12,
          unit: "unidades",
        },
        {
          id: 4,
          name: "Queso cremoso",
          category: "L√°cteos",
          quantity: 2,
          unit: "kg",
        },
        { id: 5, name: "Caf√©", category: "Almac√©n", quantity: 500, unit: "mg" },
      ];

      // Elementos del DOM
      const tableBody = document.getElementById("table-body");
      const searchInput = document.getElementById("search-input");
      const addProductBtn = document.getElementById("add-product-btn");
      const modal = document.getElementById("product-modal");
      const closeBtn = document.querySelector(".close");
      const productForm = document.getElementById("product-form");
      const modalTitle = document.getElementById("modal-title");

      // Variables para controlar si estamos editando
      let isEditing = false;
      let currentEditId = null;

      // Mostrar productos en la tabla
      function renderInventory(products = inventory) {
        tableBody.innerHTML = "";

        products.forEach((product) => {
          const row = document.createElement("tr");

          row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.quantity}</td>
                    <td>${formatUnit(product.unit)}</td>
                    <td class="no-print action-btns">
                        <button class="edit-btn" data-id="${
                          product.id
                        }">‚úèÔ∏è Editar</button>
                        <button class="btn-danger delete-btn" data-id="${
                          product.id
                        }">üóëÔ∏è Eliminar</button>
                    </td>
                `;

          tableBody.appendChild(row);
        });

        // Agregar event listeners a los botones de editar y eliminar
        document.querySelectorAll(".edit-btn").forEach((btn) => {
          btn.addEventListener("click", handleEdit);
        });

        document.querySelectorAll(".delete-btn").forEach((btn) => {
          btn.addEventListener("click", handleDelete);
        });
      }

      // Formatear unidad para mostrar
      function formatUnit(unit) {
        const unitsMap = {
          unidades: "Unidades",
          kg: "Kg",
          mg: "Mg",
        };
        return unitsMap[unit] || unit;
      }

      // Buscar productos
      function searchProducts(query) {
        if (!query) {
          renderInventory();
          return;
        }

        const normalizedQuery = normalizeString(query.toLowerCase());

        const results = inventory.filter((product) => {
          const normalizedName = normalizeString(product.name.toLowerCase());
          const normalizedCategory = normalizeString(
            product.category.toLowerCase()
          );

          return (
            normalizedName.includes(normalizedQuery) ||
            normalizedCategory.includes(normalizedQuery)
          );
        });

        renderInventory(results);
      }

      // Normalizar string para b√∫squeda (quitar acentos)
      function normalizeString(str) {
        return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
      }

      // Manejar b√∫squeda en tiempo real
      searchInput.addEventListener("input", (e) => {
        searchProducts(e.target.value);
      });

      // Abrir modal para agregar producto
      addProductBtn.addEventListener("click", () => {
        isEditing = false;
        currentEditId = null;
        modalTitle.textContent = "Agregar Producto";
        productForm.reset();
        document.getElementById("product-id").value = "";
        modal.style.display = "block";
      });

      // Cerrar modal
      closeBtn.addEventListener("click", () => {
        modal.style.display = "none";
      });

      // Cerrar modal al hacer clic fuera
      window.addEventListener("click", (e) => {
        if (e.target === modal) {
          modal.style.display = "none";
        }
      });

      // Manejar env√≠o del formulario (agregar/editar)
      productForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const productData = {
          name: document.getElementById("product-name").value,
          category: document.getElementById("product-category").value,
          quantity: parseFloat(
            document.getElementById("product-quantity").value
          ),
          unit: document.getElementById("product-unit").value,
        };

        if (isEditing) {
          // Editar producto existente
          const index = inventory.findIndex((p) => p.id === currentEditId);
          if (index !== -1) {
            inventory[index] = { ...inventory[index], ...productData };
          }
        } else {
          // Agregar nuevo producto
          const newId =
            inventory.length > 0
              ? Math.max(...inventory.map((p) => p.id)) + 1
              : 1;
          inventory.push({ id: newId, ...productData });
        }

        renderInventory();
        modal.style.display = "none";
        searchProducts(searchInput.value);
      });

      // Manejar edici√≥n de producto
      function handleEdit(e) {
        const productId = parseInt(e.target.getAttribute("data-id"));
        const product = inventory.find((p) => p.id === productId);

        if (product) {
          isEditing = true;
          currentEditId = productId;
          modalTitle.textContent = "Editar Producto";

          document.getElementById("product-id").value = product.id;
          document.getElementById("product-name").value = product.name;
          document.getElementById("product-category").value = product.category;
          document.getElementById("product-quantity").value = product.quantity;
          document.getElementById("product-unit").value = product.unit;

          modal.style.display = "block";
        }
      }

      // Manejar eliminaci√≥n de producto
      function handleDelete(e) {
        if (confirm("¬øEst√°s seguro de que quer√©s eliminar este producto?")) {
          const productId = parseInt(e.target.getAttribute("data-id"));
          inventory = inventory.filter((p) => p.id !== productId);
          renderInventory();
          searchProducts(searchInput.value);
        }
      }

      // Inicializar la tabla
      renderInventory();
    </script>
  </body>
</html>
